{
    "Rules" :
    [
        {
            "RuleName" : "Test1",
            "SourceEvents" :
            [
                {
                    "EventName" : "ProcessStart",
                    "ConnectTo" : { "StringFilter_1" : { "SignalParameter":"#MACRO#Context.Event.ProcessName" } }
                },
                {
                    "EventName" : "ProcessExit",
                    "ConnectTo" : { "KeyedCollectorInOrder_1" : { "SignalParameter": [ "#MACRO#Context.Event.ProcessId", 0, true ] } }
                },
                {
                    "EventName" : "FileCreated",
                    "ConnectTo" : { "KeyedCollectorInOrder_1" : { "SignalParameter" : [ "#MACRO#Context.Event.ProcessId", 1] } }
                }, 
                {
                    "EventName" : "ScriptExec",
                    "ConnectTo" : { "KeyedCollectorInOrder_2" : { "SignalParameter" : [ "#MACRO#Context.Event.Path", 1] } }
                } 
            ],
            "Primitives":
            [
                {
                    "Type" : "StringFilter",
                    "Name" : "StringFilter_1",
                    "Parameters" : {
                        "Method" : "MatchSingle",
                        "Condition" : "Equals",
                        "MatchTo" : "Notepad.exe"
                    },
                    "ConnectTo" : { "KeyedCollectorInOrder_1" : { "SignalParameter" : [ "#MACRO#Context.Event.ProcessId", 0] } }
                },
                {
                    "Type" : "KeyedCollectorInOrder",
                    "Name" : "KeyedCollectorInOrder_1",
                    "Parameters" : { "SourceCount" : 2 },
                    "ConnectTo" : { "KeyedCollectorInOrder_2" : { "SignalParameter" : [ "#MACRO#Contexts[1].Event.Path", 0] } }
                },
                {
                    "Type" : "KeyedCollectorInOrder",
                    "Name" : "KeyedCollectorInOrder_2",
                    "Parameters" : { "SourceCount" : 2 },
                    "ConnectTo" : { "EventGenerator_1" : {} }
                },
                {
                    "Type" : "EventGenerator",
                    "Name" : "EventGenerator_1",
                    "Parameters" : { 
                        "NewEventName" : "MaliciousScriptExec",
                        "Properties" : {
                            "Path" : "#MACRO#Contexts[1].Event.Path",
                            "CreatorName" : "#MACRO#Contexts[0][0].Event.ProcessName",
                            "CreatorProcId" : "#MACRO#Contexts[0][0].Event.ProcessId",
                        }
                    }
                }
            ],
        }
    ]
}